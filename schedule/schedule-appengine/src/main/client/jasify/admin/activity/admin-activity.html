<div class="row">
    <div class="col-sm-1">
        <a ng-click="vm.back()"><span class="glyphicon glyphicon-arrow-left"></span> back</a>
    </div>
    <div class="col-sm-4">
        <form class="form-horizontal" role="form" name="vm.organizationForm" novalidate>
            <div class="form-group">
                <label class="control-label col-sm-4" for="organization">Organization:</label>

                <div class="col-sm-7">
                    <select ng-model="vm.organization" id="organization" class="form-control"
                            ng-options="organization as organization.name for organization in vm.organizations"
                            ng-change="vm.loadActivityTypes(vm.organization)">
                    </select>
                </div>
            </div>
        </form>
    </div>
    <div class="col-sm-7">
        <alert ng-repeat="a in vm.alerts" type="{{a.type}}" close="vm.alerts.splice($index, 1)">{{a.msg}}</alert>
    </div>
</div>
<div class="row">
    <div class="col-sm-6 well well-sm text-center" ng-hide="vm.organization.id">Select an organization.</div>
    <div class="col-sm-6" ng-show="vm.organization.id">
        <form class="form-horizontal" role="form" name="vm.activityForm" novalidate>
            <fieldset>
                <legend class="h4">Activity</legend>
                <div class="form-group">
                    <label for="activityType" class="col-sm-3 control-label">Activity Type:</label>

                    <div class="col-sm-8 has-feedback" ng-class="vm.hasActivityTypes() ? false : 'has-error'">
                        <select ng-model="vm.activity.activityType" id="activityType" class="form-control"
                                ng-options="activityType as activityType.name for activityType in vm.activityTypes"
                                ng-change="vm.activity.description = vm.activity.activityType.description">
                        </select>

                        <div class="help-block small" ng-hide="vm.hasActivityTypes()">
                            You need to <a ng-href="#/admin/organization/{{vm.organization.id}}">create an activity</a>
                            type before you can create an activity.
                        </div>

                    </div>
                </div>
                <div class="form-group">
                    <label for="description" class="col-sm-3 control-label">Description:</label>

                    <div class="col-sm-8">
                    <textarea class="form-control input-sm" id="description" ng-model="vm.activity.description"
                              rows="3">
                    </textarea>
                    </div>
                </div>
                <div class="form-group">
                    <label for="start" class="col-sm-3 control-label">Start:</label>

                    <div class="col-sm-8">
                        <p class="input-group">
                            <input id="start" type="text" class="form-control"
                                   datepicker-popup="{{vm.dateFormat}}"
                                   ng-model="vm.activity.start" is-open="vm.isStartOpen" min-date="vm.minStartDate"
                                   ng-required="true" ng-focus="vm.openStart($event)" close-text="Close"/>
                            <span class="input-group-btn">
                                <button type="button" class="btn btn-default" ng-click="vm.openStart($event)"><i
                                        class="glyphicon glyphicon-calendar"></i></button>
                            </span>
                        </p>
                    </div>
                </div>
                <div class="form-group">
                    <label for="finish" class="col-sm-3 control-label">Finish:</label>

                    <div class="col-sm-8">
                        <p class="input-group">
                            <input id="finish" type="text" class="form-control"
                                   datepicker-popup="{{vm.dateFormat}}"
                                   ng-model="vm.activity.finish" is-open="vm.isFinishOpen"
                                   min-date="vm.activity.start"
                                   ng-required="true" ng-focus="vm.openFinish($event)" close-text="Close"/>
                            <span class="input-group-btn">
                                <button type="button" class="btn btn-default" ng-click="vm.openFinish($event)"><i
                                        class="glyphicon glyphicon-calendar"></i></button>
                            </span>
                        </p>
                    </div>
                </div>
                <div class="form-group" ng-show="!vm.activity.id">
                    <label for class="col-sm-3 control-label" tooltip="Maximum {{vm.repeatMaximum}} allowed">Repeat:</label>

                    <div class="col-sm-8">
                        <span class="input-group-btn">
                            <select style="vertical-align:middle" ng-model="vm.repeatType" class="form-control">
                                <option ng-repeat="rt in vm.repeatTypes" value="{{rt}}">{{rt}}</option>
                            </select>
                        </span>
                    </div>
                </div>
                <div class="form-group" ng-show="vm.repeatType=='Weekly'">
                    <label for class="control-label col-sm-5">Days:</label>

                    <div class="btn-group col-sm-6">
                        <label class="btn btn-primary" ng-model="vm.repeatDays[1]" btn-checkbox>M</label>
                        <label class="btn btn-primary" ng-model="vm.repeatDays[2]" btn-checkbox>T</label>
                        <label class="btn btn-primary" ng-model="vm.repeatDays[3]" btn-checkbox>W</label>
                        <label class="btn btn-primary" ng-model="vm.repeatDays[4]" btn-checkbox>T</label>
                        <label class="btn btn-primary" ng-model="vm.repeatDays[5]" btn-checkbox>F</label>
                        <label class="btn btn-primary" ng-model="vm.repeatDays[6]" btn-checkbox>S</label>
                        <label class="btn btn-primary" ng-model="vm.repeatDays[0]" btn-checkbox>S</label>
                    </div>
                </div>
                <div class="form-group" ng-show="vm.repeatType!='No'">
                    <label for class="control-label col-sm-5">Every:</label>

                    <div class="col-sm-6">
                        <input type="number" min="1" class="form-control" ng-model="vm.repeatEvery"/>
                    </div>
                </div>
                <div class="form-group" ng-show="vm.repeatType!='No'">
                    <label for class="control-label col-sm-5">Until:</label>

                    <div class="col-sm-6">
                        <select style="vertical-align:middle" ng-model="vm.repeatEndType" class="form-control">
                            <option ng-repeat="rt in vm.repeatEndTypes" value="{{rt}}">{{rt}}</option>
                        </select>

                        <div ng-show="vm.repeatEndType=='Count'">
                            <input type="number" min="1" class="form-control" ng-model="vm.repeatCount"/>
                        </div>
                        <div class="input-group" ng-show="vm.repeatEndType=='Date'">
                            <input id="repeat" name="repeat" type="text" class="form-control"
                                   datepicker-popup="{{vm.dateFormat}}"
                                   ng-model="vm.repeatDate" is-open="vm.isRepeatOpen" min-date="vm.activity.finish"
                                   ng-focus="vm.openRepeat($event)" close-text="Close"/>
                            <span class="input-group-btn">
                            <button type="button" class="btn btn-default" ng-click="vm.openRepeat($event)"><i
                                    class="glyphicon glyphicon-calendar"></i></button>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="price" class="col-sm-3 control-label">Price:</label>

                    <div class="col-sm-3">
                        <input id="price" type="number" min="0" class="form-control" ng-model="vm.activity.price"
                               ng-change="vm.activity.currency='CHF'"/>
                    </div>
                    <div class="col-sm-2 text-left">
                        <select ng-model="vm.activity.currency" class="form-control">
                            <option>CHF</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="location" class="col-sm-3 control-label">Location:</label>

                    <div class="col-sm-8">
                        <input id="location" type="text" class="form-control" ng-model="vm.activity.location"/>
                    </div>
                </div>
                <div class="form-group">
                    <label for="maxSubscriptions" class="col-sm-3 control-label"
                           tooltip="Maximum number of subscriptions allowed">Subscriptions(max):</label>

                    <div class="col-sm-8">
                        <input id="maxSubscriptions" type="number" min="0" class="form-control"
                               ng-model="vm.activity.maxSubscriptions"/>
                    </div>
                </div>
            </fieldset>
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                    <button type="button" ng-if="vm.activity.id"
                            ng-click="vm.update()" ng-disabled="!vm.activityForm.$dirty || vm.activityForm.$invalid"
                            class="btn btn-default btn-sm btn-primary">
                        <span class="glyphicon glyphicon-save"></span> update
                    </button>
                    <button type="button" ng-if="!vm.activity.id"
                            ng-click="vm.create()" ng-disabled="!vm.activityForm.$dirty || vm.activityForm.$invalid"
                            class="btn btn-default btn-sm btn-primary">
                        <span class="glyphicon glyphicon-plus"></span> create
                    </button>
                    <button type="button"
                            ng-click="vm.reset()" ng-disabled="!vm.activityForm.$dirty" class="btn btn-default btn-sm">
                        <span class="glyphicon glyphicon-open"></span> reset
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>